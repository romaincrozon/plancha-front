<div class=" content"  #el>
	<div class="row">
		<div class="col-md-12">
			<div class=" card">
				<div class=" card-header">
					<h4 class=" card-title">Plan de charge</h4>
				</div>
				<div class="card-body" *ngIf="projects?.length > 0; else noItemsFound">
					<div>
						<app-grid-parameters [projects]="allProjects"></app-grid-parameters>
					</div>	
<!-- 					<app-resource-synthesis [projects]="projects" [calendar]="calendar"></app-resource-synthesis> -->
					<div class=" table-responsive" >
						<table class=" table tablesorter">
							<thead class=" text-primary">
								<tr>
									<th class="empty-cell" colspan="5"></th>
									<th *ngFor="let month of calendar?.monthList" [attr.colspan]="month.numberOfDays" >{{month.name}}</th>
								</tr>
								<tr>
									<th class="empty-cell" colspan="5"></th>
									<th *ngFor="let week of calendar?.weekList" [attr.colspan]="week.numberOfDays">S{{week.numWeek}}</th>
								</tr>
								<tr style="display:none">
									<th class="empty-cell" colspan="5"></th>
									<th *ngFor="let date of calendar?.planchaCalendarList" [ngStyle]="{'background-color' : date.holiday ? 'red': 'gainsboro'}" >{{date.calendar | date:'d'}}</th>
								</tr>
							</thead>
							<tbody>
								<ng-container *ngFor="let resource of resources">
									<tr>
										<td>{{resource.quadri}}%</td>
										<td *ngFor="let resourceCalendar of resource?.resourceCalendars" [attr.data-calendar]="calendar.calendar" [attr.data-project-id]="project.id" #count>{{resourceCalendar | countProjectPipe:calendar}}</td>
									</tr>
									<tr>
										<td *ngFor="let resourceCalendar of resource?.resourceCalendars" [attr.data-calendar]="calendar.calendar" [attr.data-project-id]="project.id" #count>{{resourceCalendar | countProjectPipe:calendar}}</td>
									</tr>
									<tr>
										<td *ngFor="let resourceCalendar of resource?.resourceCalendars" [attr.data-calendar]="calendar.calendar" [attr.data-project-id]="project.id" #count>{{resourceCalendar | countProjectPipe:calendar}}</td>
									</tr>
								</ng-container>
								<ng-container *ngFor="let project of projects">
									<tr>
										<td>{{project.confidencePercentage}}%</td>
										<td [attr.colspan]="4">{{project.name}}</td>
										<td *ngFor="let calendar of calendar?.planchaCalendarList" [attr.colspan]="" [attr.data-calendar]="calendar.calendar" [attr.data-project-id]="project.id" #count>{{project.subProjectList | countProjectPipe:calendar}}</td>
									</tr>
									<ng-container *ngFor="let subproject of project?.subProjectList">
										<tr>
											<td></td>
											<td [attr.colspan]="3">{{subproject.name}}</td>
											<td *ngFor="let calendar of calendar?.planchaCalendarList" [attr.data-calendar]="calendar.calendar" [attr.data-subproject-id]="subproject.id" #count>{{subproject.taskList | countSubprojectPipe:calendar}}</td>
										</tr>
										<ng-container *ngFor="let task of subproject?.taskList">
											<tr>
												<td></td>
												<td></td>
												<td>{{task.name}}</td>
												<td>
													<button (click)="openFormModal()" type="button" class="btn btn-link">
                      									<i class="tim-icons icon-pencil"></i>
                    								</button>
                    							</td>
												<td *ngFor="let calendar of calendar?.planchaCalendarList" [attr.data-calendar]="calendar.calendar" [attr.data-task-id]="task.id" #count>{{task.resourceCalendars | countTaskPipe:calendar}}</td>
											</tr>
											<tr *ngFor="let resourceCalendar of task?.resourceCalendars"
												app-planning-row
												(valueChange)="sum($event)"
												[resourceCalendar]="resourceCalendar"
												[projectResources]="project?.resources"
												[gridParameters]="gridParameters"					
												[calendars]="calendar?.planchaCalendarList"
												[weeks]="calendar?.weekList"
												[project]="project"
												[subproject]="subproject"
												[task]="task">
											</tr>
										</ng-container>
									</ng-container> 
								</ng-container>
							</tbody>
						</table>
					</div>
				</div>
				<ng-template #noItemsFound>
					<div class="card-body" >
						Pas de projets trouv&eacute;s
					</div>
				</ng-template>
			</div>
		</div>
	</div>
</div>